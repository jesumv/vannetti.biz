<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="utf-8">
	
	  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame 
	       Remove this if you use the .htaccess -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Vannetti Cucina</title>
	<meta name="author" content="jmv">
	<meta name="viewport" content="width=device-width; initial-scale=1.0">
	<link rel="shortcut icon" href="img/logomin.gif" />  
	<link rel="apple-touch-icon" href="img/logomin.gif">
	<link rel="stylesheet" href= "css/jquery.mobile-1.4.5.min.css" />
	<link rel="stylesheet" href= "css/movil.css" />
	<script src="js/jquery.js"></script>
	<script src="js/jquery.mobile-1.4.5.min.js"></script>
	<script src="js/jquery.number.js"></script>

	<script>
			$(document).ready(function() {
					//traer funciones auxiliares
		  		$.getScript( "js/fauxoc.js");
		  		
		//eventos para los botones de accion
			$("#envia").click(function(){
				var resul1 = validaelem("tcant","0");
				
		//si no hay datos que enviar
				if(resul1==0){
					aviso("No ha solicitado ningun articulo");
					$( "#aviso" ).on( "popupafterclose", function( event, ui ) {
							if($("#cant0")){$("#cant0").focus();}
						} );
					}else{
						//recoleccion de variables
						var prov = $("#ocprov").val();
						var total =$("#tprec").text();
						var longi = $(".cant").length;
						var prods=[];
						var cant=[];
						var preciou=[];
						var preciot=[];
						var longcants = 0;
						for(var z=0; z <longi; z++){
							if($("#cant".concat(z)).val()!==""){
								prods[longcants] = $("#id".concat(z)).text();
								cant[longcants] = $("#cant".concat(z)).val();
								preciou[longcants]= $("#costo".concat(z)).text();
								preciot[longcants]= $("#subt".concat(z)).text();
								longcants++;
							}
						}
						longcants--;
						//si todo ok, se envian los datos
						$.post( "php/enviaoc.php",
						{	prov:prov,
							longi:longcants,
							prods:prods,
							cants:cant,
							preciou:preciou,
							preciot:preciot,
							total:total
						 }, null, "json" )
    						.done(function( data) {
    							var noc= data.noc;
    							var arts =data.arts;
    							var total = data.total;
    							var cad = "ORDEN DE COMPRA OK <br>Numero: "+ noc + "<br>"+"Arts: "+arts+"<br>"+"total: "+total;
								aviso(cad);
								$( "#aviso" ).on( "popupafterclose", function( event, ui ) {
									location.reload();
									$('#ocprov').selectmenu( "enable" );
								} );
    						})
    						.fail(function( data ) {
    							var err1 = data.success;
    							aviso("error alta de oc: "+err1);
							});	
					}
		  		
		   });
		   
		   $("#cancela").click(function(){
		   		location.reload();
		   		$('#ocprov').selectmenu( "enable" );
		   });
		   
		 });
	</script>
</head>

<body>
  <div data-role="page"> 
    <div data-role="header">
    <a href="portalmov.html" data-ajax="false" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-icon-home">Inicio</a>
<h1>Orden De Compra</h1>
    <a href="portalmov.html" data-ajax="false" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-icon-delete">Cerrar</a>
</div>
    <div class="ui-content">
		<form  method="post"
		enctype="application/x-www-form-urlencoded" name="ocforma" id="ocforma">
			<label for="ocprov" class="select">Proveedor</label>
			<select name="ocprov" id="ocprov">
			    <option value="0">Seleccione al proveedor</option>
			</select>			
			<fieldset class="ui-grid-b tablaoculta" id="octabla">
				<div class="ocult">id</div>
			    <div class="ui-block-a"><div class="ui-bar ui-bar-b">Producto</div></div>
			 	<div class="ocult">Costo</div>
			    <div class="ui-block-b"><div class="ui-bar ui-bar-b">Cantidad</div></div>
			    <div class="ui-block-c"><div class="ui-bar ui-bar-b">Subtotal</div></div>
			</fieldset>	
		    <input data-theme="b" data-icon="check" data-iconshadow="true" value="Enviar" type="button" 
		    name="envia"id="envia">
		    <div class="ui-input-btn ui-btn ui-btn-b ui-icon-delete ui-btn-icon-left ui-shadow-icon" 
		    name="cancela"id="cancela">
		        Cancelar
		    <input data-enhanced="true" value="Enhanced" type="button">
		    </div>
		</form>
    </div>
    
<div data-role="popup" id="aviso">
	<p>Sin texto, todav√≠a.</p>
</div>
  </div>
</body>
</html>
